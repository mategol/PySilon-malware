import os
import random
import socket
import struct
import string
from flask import Flask, request, send_file

app = Flask(__name__)

def generate_random_ip(length=20):
    characters = string.ascii_letters + string.digits
    return ''.join(random.choice(characters) for _ in range(length))

@app.route('/')
def generate_download_link():
    random_ip = generate_random_ip()

    base_url = request.url_root
    download_link = f"{base_url}download/{random_ip}/{file_name}"
    print(f"Your generated download link: {base_url}download/{random_ip}/{file_name}")
    return f"Welcome! Your download link: <a href='{download_link}'>{download_link}</a>"

@app.route('/download/<ip_address>/<file_name>')
def download_file(ip_address, file_name):
    try:
        socket.inet_aton(ip_address)
    except socket.error:
        return "Invalid IP address."
    if os.path.exists(file_path):
        return send_file(file_path, as_attachment=True)
    else:
        return "File not found."

if __name__ == '__main__':
    file_path = input("Enter the file path: ")
    file_name = os.path.basename(file_path)
    port = random.randint(1024, 49151)
    app.run(host='0.0.0.0', port=port, debug=False)
